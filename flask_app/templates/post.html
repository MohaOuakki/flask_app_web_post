{% extends "base.html" %}
{% block content %}

<div class="single-post-container">
  <!-- Back Button -->
  <div class="post-back-btn mb-3">
    <a href="{{ url_for('home') }}" class="btn-back-nav">
      <i class="bi bi-arrow-left me-2"></i>
      <span>Back to feed</span>
    </a>
  </div>

  <!-- Post Card -->
  <article class="single-post-card">
    <!-- Post Header -->
    <div class="single-post-header">
      <div class="d-flex align-items-start gap-3">
        <img 
          src="{{ url_for('static', filename='imgs/' + post.author.image_file) }}" 
          alt="{{ post.author.username }}"
          class="post-author-avatar"
        />
        <div class="flex-grow-1">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div>
              <h4 class="post-author-name mb-0">{{ post.author.username }}</h4>
              <p class="post-author-handle mb-0">@{{ post.author.username|lower }}</p>
            </div>
            
            {% if post.author == current_user %}
            <div class="dropdown">
              <button class="btn-post-options" data-bs-toggle="dropdown">
                <i class="bi bi-three-dots"></i>
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <a class="dropdown-item" href="{{ url_for('update_post', post_id=post.id) }}">
                    <i class="bi bi-pencil me-2"></i>Edit post
                  </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <a class="dropdown-item text-danger" href="#" data-bs-toggle="modal" data-bs-target="#DeleteModal">
                    <i class="bi bi-trash me-2"></i>Delete post
                  </a>
                </li>
              </ul>
            </div>
            {% endif %}
          </div>
          
          <div class="post-metadata">
            <span>
              <i class="bi bi-calendar3 me-1"></i>
              {{ post.date_posted.strftime('%B %d, %Y at %I:%M %p') }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Post Title -->
    <h1 class="single-post-title">{{ post.title }}</h1>

    <!-- Post Content -->
    <div class="single-post-content">
      <p>{{ post.content }}</p>
    </div>

    <!-- Post Image -->
    {% if post.image_file %}
    <div class="single-post-image">
      <img 
        src="{{ url_for('static', filename='uploads/' + post.image_file) }}" 
        alt="{{ post.title }}"
        class="w-100"
      />
    </div>
    {% endif %}

    <!-- Post Stats -->
    <div class="post-stats-bar">
      <span class="stat-text">
        <i class="bi bi-chat me-1"></i>0 comments
      </span>
      <span class="stat-text">
        <i class="bi bi-heart me-1"></i>0 likes
      </span>
      <span class="stat-text">
        <i class="bi bi-eye me-1"></i>0 views
      </span>
    </div>

    <!-- Post Actions -->
    <div class="post-actions-bar">
      <button class="post-action-btn">
        <i class="bi bi-chat"></i>
        <span>Comment</span>
      </button>
      <button class="post-action-btn">
        <i class="bi bi-heart"></i>
        <span>Like</span>
      </button>
      <button class="post-action-btn">
        <i class="bi bi-bookmark"></i>
        <span>Save</span>
      </button>
      <button class="post-action-btn">
        <i class="bi bi-share"></i>
        <span>Share</span>
      </button>
    </div>
  </article>

  <!-- Comments Section -->
  <div class="comments-container">
    <h3 class="comments-title">
      <i class="bi bi-chat-left-text me-2"></i>
      Comments
    </h3>

    <!-- Comment Form -->
    {% if current_user.is_authenticated %}
    <div class="comment-compose">
      <img 
        src="{{ url_for('static', filename='imgs/' + current_user.image_file) }}" 
        alt="{{ current_user.username }}"
        class="comment-avatar"
      />
      <div class="comment-input-wrapper">
        <textarea 
          class="comment-textarea" 
          placeholder="Write a comment..."
          rows="3"
        ></textarea>
        <div class="comment-actions">
          <div class="comment-tools">
            <button class="tool-btn" title="Add emoji">
              <i class="bi bi-emoji-smile"></i>
            </button>
            <button class="tool-btn" title="Add image">
              <i class="bi bi-image"></i>
            </button>
          </div>
          <button class="btn btn-primary btn-sm">
            <i class="bi bi-send me-1"></i>Comment
          </button>
        </div>
      </div>
    </div>
    {% else %}
    <div class="alert alert-info">
      <i class="bi bi-info-circle me-2"></i>
      <a href="{{ url_for('login') }}" class="alert-link">Login</a> to join the discussion
    </div>
    {% endif %}

    <!-- Comments List (Empty State) -->
    <div class="empty-comments">
      <i class="bi bi-chat-dots display-4"></i>
      <p class="mt-3 mb-0">No comments yet. Be the first to share your thoughts!</p>
    </div>
  </div>

  <!-- Related Posts -->
  <div class="related-posts-section">
    <h3 class="section-title">
      <i class="bi bi-grid me-2"></i>
      More from {{ post.author.username }}
    </h3>
    <div class="empty-state-small">
      <i class="bi bi-inbox"></i>
      <p>No other posts available</p>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="DeleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-exclamation-triangle text-danger me-2"></i>Delete Post
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="mb-2">Are you sure you want to delete this post?</p>
        <div class="alert alert-warning mb-0">
          <i class="bi bi-info-circle me-2"></i>
          <small>This action cannot be undone.</small>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <form action="{{ url_for('delete_post', post_id=post.id) }}" method="POST" class="d-inline">
          <button type="submit" class="btn btn-danger">
            <i class="bi bi-trash me-1"></i>Delete
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock content %}